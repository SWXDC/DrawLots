<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style/index.css">
    <title>Document</title>
</head>
<body>
    <div class="page">
        <div class="display">
            <h1 id="display-number">#</h1>
        </div>
        <div class="console">
            <div class="block1">
                <textarea id="content" placeholder="輸入內容..."></textarea>
                <span>
                    <button onclick="reset()">重設</button>
                    <button onclick="start()">開始</button>
                </span>
            </div>
            <div class="block2">
                <h1>批量增加</h1>
                <input id="start" type="text" placeholder="開始">
                <h1>↓</h1>
                <input id="end" type="text" placeholder="結束">
                <button onclick="batch()">增加</button>
            </div>
        </div>
    </div>

    <script>
        var e = true;
        var content = document.querySelector("#content");
        var number = document.querySelector("#display-number");
        const first = content.value = "1 \n2 \n3 \n4";

        let rolling = false; // 是否正在滾動
        let interval; // 設定的間隔

        content.addEventListener("keyup", function(action) {
            console.log(content.value);
        });

        function batch() {
            if (e === true) {
                content.value = ""; 
            }
            e = false;
            var start = document.querySelector("#start");
            var end = document.querySelector("#end");

            var startValue = parseInt(start.value);
            var endValue = parseInt(end.value);
            if (isNaN(startValue) || isNaN(endValue)) {
                alert("請輸入有效的數字！");
                return;
            }

            var time = endValue - startValue;
            for (let i = 0; i <= time; i++) {
                content.value += (startValue + i) + "\n";
            }
        }

        function convertToList() {
            const text = content.value;
            const list = text.split('\n').filter(Boolean);
            return list;
        }

        function random(time) {
            const list = convertToList();
            if (time > 0 && list.length > 0) {
                const randomIndex = Math.floor(Math.random() * list.length);
                const randomValue = list[randomIndex];
                const updatedList = list.filter((_, index) => index !== randomIndex);
                content.value = updatedList.join('\n');
                return randomValue;
            }
            return null;
        }

        function start() {
            if (rolling) return; // 防止重複啟動
            rolling = true; // 標記為正在滾動

            const list = convertToList();
            const time = list.length;

            let count = 0; // 記錄滾動次數
            const finalCount = 10; // 可以設定總共滾動的次數
            const finalResult = random(time); // 最終結果，隨機一個數字

            // 開始滾動的間隔
            interval = setInterval(() => {
                // 清空顯示區域
                number.textContent = "";

                // 隨機選擇一個數字作為顯示
                const randomValue = random(time);
                
                // 更新顯示數字
                number.textContent = randomValue + "<"; // 在數字後面加上 '<'

                count++;

                // 檢查是否達到總共滾動的次數
                if (count >= finalCount) {
                    clearInterval(interval); // 停止滾動
                    number.textContent = finalResult; // 更新顯示為最終數字
                    rolling = false; // 重置為不在滾動狀態
                }
            }, 300); // 每300毫秒更新一次
        }

        function reset() {
            e = true;
            content.value = first; 
            number.textContent = "#"; 
        }
    </script>
</body>
</html>
